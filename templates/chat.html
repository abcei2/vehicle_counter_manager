<!doctype html>
<html lang="es">
    <body>
      
        <input id="image-file" type="file" onchange="test(this)" >
        <script>
            async function test(ev){
                
                let photo = ev.files[0];      
                    
                let formdata = new FormData();
                console.log(photo)
                formdata.append("myfile", ev.files[0]);

                var requestOptions = {
                method: 'POST',
                body: formdata,
                redirect: 'follow'
                };

                fetch("http://localhost:8000", requestOptions)
                .then(response => response.text())
                .then(result => console.log(result))
                .catch(error => console.log('error', error));
            }
           
         /*
          * VARIABLES
          */
         // Define el nombre de la sala
         const SALA_CHAT = 'python';
         // Conecta con WebSockets
         const CHAT_SOCKET = new WebSocket('ws://192.168.1.1:8000/ws/chat/' + SALA_CHAT + '/');
         // Captura el campo con el nombre del usuario


         /*
          * FUNCIONES
          */

         /**
          * MÃ©todo que envia el mensaje al consumer por medio de WebSockets
          */
         function enviarNuevoMensaje(mensaje) {
             // Envia al WebSocket un nuevo mensaje
             CHAT_SOCKET.send(JSON.stringify({
                 polys: [],
                 nombre: "hello",
                 mensaje: mensaje
             }));
         }

         /*
          * EVENTOS
          */

         // Conectado
         CHAT_SOCKET.addEventListener('open', () => {
             console.log('Conectado');
             enviarNuevoMensaje("empezando esta monda!")
         });
         // Desconectado
         CHAT_SOCKET.addEventListener('close', () => {
              console.log('Desconectado');
          });

         // Recibir mensaje
         CHAT_SOCKET.addEventListener('message', (event) => {
             console.log(event.data*100);
            
          });

        </script>
    </body>
</html>